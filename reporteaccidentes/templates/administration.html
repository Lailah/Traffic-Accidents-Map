{% load i18n %}
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <title>Reporte de accidentes de Transito en Montevideo</title>
        <script type="text/javascript" src="{{ MEDIA_URL }}js/jquery-1.6.1.min.js"></script>
        <script type="text/javascript" src="{{ MEDIA_URL }}js/jquery-ui-1.8.13.custom.min.js"></script>
	<link rel="stylesheet" type="text/css" href="{{ MEDIA_URL }}css/ui.spinner.css" />
	<script type="text/javascript" src="{{ MEDIA_URL }}js/ui.spinner.js"></script>
        <link type="text/css" href="{{ MEDIA_URL }}css/jquery-ui-1.8.14.custom.css" rel="Stylesheet" />
        <link rel="stylesheet" type="text/css" href= "{{ MEDIA_URL }}css/administration.css"/>
	<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true"></script>
	<script type="text/javascript">
		var map; 
		var image = '{{ MEDIA_URL }}images/icons/fatal.png';

		function initialize(){
		  var myLatlng = new google.maps.LatLng(-34.905833, -56.191389); 
		  var myOptions = {
		    zoom: 11,
		    center: myLatlng,
		    mapTypeId: google.maps.MapTypeId.ROADMAP
		  }
		  map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);
		 var parameters = {};   
		      parameters["cantidad"] = 40
		$.get('/update.ajax', parameters, function(data){
		clear();
		var locations = eval(data)
		    for (i = 0; i < locations.length; i++) {  
		       marker = new google.maps.Marker({
			position: new google.maps.LatLng(locations[i][1], locations[i][2]),
			map: map, 
			icon: image,
			title:locations[i][0]
		      });
		}
		})

		}


		function clear(){
		  var myLatlng = new google.maps.LatLng(-34.905833, -56.191389); 
		  var myOptions = {
		    zoom: 11,
		    center: myLatlng,
		    mapTypeId: google.maps.MapTypeId.ROADMAP
		  }
		  map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);
		}

		function todos_accidentes(){
		    clear();
		    var locations = {%  include "generated/todos_accidentes.inc" %}
		    for (i = 0; i < locations.length; i++) {  
		      marker = new google.maps.Marker({
			position: new google.maps.LatLng(locations[i][1], locations[i][2]),
			map: map, 
	                title:locations[i][0]
		      });
		}
		}

		function markers2006(){
		    clear();
		    var locations = {%  include "generated/accidentes_2006.inc" %}
		    for (i = 0; i < locations.length; i++) {  
		      marker = new google.maps.Marker({
			position: new google.maps.LatLng(locations[i][1], locations[i][2]),
			map: map, 
	                title:locations[i][0]
		      });
		}
		}
		function markers2007(){
		    clear();
		    var locations = {%  include "generated/accidentes_2007.inc" %}
		    for (i = 0; i < locations.length; i++) {  
		      marker = new google.maps.Marker({
			position: new google.maps.LatLng(locations[i][1], locations[i][2]),
			map: map, 
	                title:locations[i][0]
		      });
		}
		}

		function markers2008(){
		    clear();
		    var locations = {%  include "generated/accidentes_2008.inc" %}
		    for (i = 0; i < locations.length; i++) {  
		      marker = new google.maps.Marker({
			position: new google.maps.LatLng(locations[i][1], locations[i][2]),
			map: map, 
	                title:locations[i][0]
		      });
		}
		}

		function markers2009(){
		    var locations = {%  include "generated/accidentes_2009.inc" %}
		    for (i = 0; i < locations.length; i++) {  
		      marker = new google.maps.Marker({
			position: new google.maps.LatLng(locations[i][1], locations[i][2]),
			map: map, 
	                title:locations[i][0]
		      });
		}
		}


		function markers2010(){
		      var locations = {%  include "generated/accidentes_2010.inc" %}
			    for (i = 0; i < locations.length; i++) {  
			      marker = new google.maps.Marker({
				position: new google.maps.LatLng(locations[i][1], locations[i][2]),
				map: map, 
			        title:locations[i][0]
			      });
			}
		}

		function actualizar(){
		    var parameters = {};   
		    if(parseInt($('#minaccidentnum').val()) > 0){
		      parameters["cantidad"] = $('#minaccidentnum').val();
		    }else{
			parameters["cantidad"] = 40;
			$('#minaccidentnum').val(40);
                    }

		    if(parseInt($('#yearfilter').val()) > 0){
		       parameters["yearfilter"] = $('#year').val();
		    }else{
			parameters["yearfilter"] = 'todo';
			$('#yearfilter').val('todo');
                    }

		    if(parseInt($('#tipofilter').val()) > 0){
		       parameters["tipo"] = $('#tipofilter').val();
		    }else{
			parameters["tipofilter"] = 'todo'
			$('#tipofilter').val('todo')
                    }



				$.get('/update.ajax', parameters, function(data){
				clear();
				var locations = eval(data)
				    for (i = 0; i < locations.length; i++) {  
				       marker = new google.maps.Marker({
					position: new google.maps.LatLng(locations[i][1], locations[i][2]),
					map: map, 
					icon: image,
					title:locations[i][0]
				      });
				}
				})
				

	
		}
		function showAboutUs(){
			$( "#about-us" ).dialog({
				height: 600,
				width: 500,
				modal: true
			});
		}


		function ranking(){
			$( "#ranking-modal" ).dialog({
				height: 600,
				width: 659,
				modal: true
			});
		}


		$(document).ready(function($) {
			$("#minaccidentnum").spinner({min: 0, max: 500, increment: 2});
		});
		function getRanking(){
		var output = "<table>"
		$.get('/ranking.ajax', function(data){
				clear();
				var locations = eval(data)
				    for (i = 0; i < locations.length; i++) {  
					output += "<tr>"
					output += "<td>"
					output += "</td>"
					output += "<td>"
					output += "</td>"
					output += "</tr>"
					}
				output += "</table>"
				})
		}

	</script>
    </head>
    <body onload="initialize()">
	<div id="about-us" title="Acerca de">
		<p style="margin-top:20px;">Este progra ha sido desarrollado para el seguimiento de los accidentes de transito con lesionados en Montevideo mediante una representacion en un mapa interactivo de los puntos donde ocurrieron. El mismo permite determinar cuales son los puntos de Montevideo donde occurrieron mas accidentes viales, lo cual ayudara a las autoridades en la identificacion de posibles problemas en la planificacion urbana y seguridad vial.</p>
<p style="margin-top:10px;">
Este programa utiliza datos abiertos liberados por la Intendencia de Montevideo, Dependencia responsable Geomática, la cual utilizo informacion suministrada por la Oficina Centralizadora de Información Táctica (OCIT) de la Jefatura de Policia de Montevido.
</p>
<p style="margin-top:10px;">
La informacion representada en este programa pertenece a los Accidentes de Transito con lesionados ocurridos en el Departamento de Montevideo en el período 2006 - 2010.
</p>
<p style="margin-top:10px;">
Archivos Shapefile con la informacion utilizada esta disponibles en: http://www.montevideo.gub.uy/datos/18664
</p>
	</div>
	<div id="ranking-modal" title="Puntos mas peligrosos">
<table style="margin-top:10px;font-family: Arial; font-size: 13px; font-weight: bold; color: #fefefe; background-color:  #888; border-top: 1px solid  #888; border-right: 1px solid  #888; border-left: 1px solid  #888; width: 627px;">
	<tr>
		<td style="width:181px;text-align:center;">Calle</td>
		<td style="width:232px;text-align:center;">Cruce</td>
		<td style="width:110px;text-align:center;">Nº Accidentes</td>
		<td style="width: 52px; text-align: center;text-align:center;"></td>
	</tr>
        </table>
		<iframe src="/ranking.html" name="ranking-grid" style="width: 625px; height: 490px;border:1px solid #888;">
		</iframe>
		<h4 style="font-style: oblique;font-weight:normal;font-size:15px;padding-top:4px;">* Datos obtenidos entre el 2006 y el 2010.</h4>
	</div>

        <table id="header" cellpadding="0" cellspacing="0" style="height: 107px;">
            <tr>
                <td id="header-top-left">
			<h1 style="padding:18px;font-size:23px;color:#fff;text-shadow: 1px 1px #333, -1px -1px #444444;">Mapa de los puntos con mayor cantidad de accidentes de Transito</h1>
                </td>
                <td id="header-top-right" align="center">
			<h2><a href="#" onclick="showAboutUs();" style="float:right;margin-left:6px;margin-right:5px;">Acerca de</a></h2>
			<h2><a href="#" onclick="ranking();" style="float:right;padding-right:6px;border-right:1px solid #eee;">Esquinas mas peligrosas</a></h2>
                </td>
            </tr>
        </table>
        <table id="main" cellpadding="0" cellspacing="0">
            <tr>
                <td rowspan="2" id="sidebar-menu" style="width: 208px;">
                    <div id="sidebar-menu-top">
		       			<table style="margin: 20px auto auto; border: 1px solid rgb(170, 170, 170); background-color: rgb(254, 254, 254); width: 190px; padding: 9px;">
			       			<tr>
				       			<td style="border: medium none; color: rgb(68, 68, 68); font-weight: bold;">
							 Periodo
				       			</td>
						</tr>
						<tr>
				       			<td style="border:none;text-align: center;">
							 <select id="yearfilter" style="background-color:#FAFAFA;text-align: right; font-size: 12px; padding: 2px; border: 1px solid rgb(204, 204, 204); height: 23px; width: 140px; font-weight: bold;">
							  <option style="text-align:right;" value="todo">2006-2010</option>
							  <option style="text-align:right;" value="2010">2010</option>
							  <option style="text-align:right;" value="2009">2009</option>
							  <option style="text-align:right;" value="2008">2008</option>
							  <option style="text-align:right;" value="2007">2007</option>
							  <option style="text-align:right;" value="2006">2006</option>
							</select>
				       			</td>
						</tr>
						<tr>
				       			<td style="border: medium none; color: rgb(68, 68, 68); font-weight: bold; padding-top: 15px;">
							 Tipo
				       			</td>
						</tr>
						<tr>
				       			<td style="border:none;text-align: center;">
							 <select id="tipofilter" style="text-align: right;background-color:#FAFAFA; font-size: 12px; padding: 2px; border: 1px solid rgb(204, 204, 204); height: 23px; width: 140px; font-weight: bold;">
							  <option style="text-align:right;" value="todo">Todos</option>
							  <option style="text-align:right;" value="1">Leve</option>
							  <option style="text-align:right;" value="2">Grave</option>
							  <option style="text-align:right;" value="3">Fatal</option>
							</select>
				       			</td>
						</tr>
						<tr>
				       			<td style="border: medium none; color: rgb(68, 68, 68); font-weight: bold; padding-top: 15px;">
							  Puntos con mayor numero de accidentes
				       			</td>
						</tr>
						<tr>
				       			<td style="text-align: center;">
								<input type="text" style="width:50px;font-size: 12px; padding: 2px; background-color:#FAFAFA;border: 1px solid rgb(204, 204, 204); height: 23px; width: 140px; font-weight: bold;" id="minaccidentnum" value="40" />
				       			</td>
			       				</tr>
<tr>
				       			<td style="border:none;text-align:center;padding-top:20px;" colspan="2">
								<input type="button" onclick="actualizar();" style="padding: 5px; width: 100px; font-size: 13px; color: rgb(255, 255, 255); background-color: orange; font-weight: bold;" value="Actualizar"/>
				       			</td>
			       			</tr>
		       			</table>
                        <table id="sidebar" cellpadding="0" cellspacing="0" style="width:159px;margin:auto;" align="center">
                            <tr>
                                <td style="border:1px solid #ddd;background-color:orange;color:#fff;">
					<h2><a style="color:#fff;" href="#" onclick="ranking();">Esquinas mas peligrosas</a></h2>
                                </td>
                            </tr>
                        </table>
                    </div>
                </td>
                <td id="center-main" style="padding:0px;">
		      <div id="map_canvas" style="width: 100%; height: 570px;margin-top:20px;margin:auto;"></div>

                </td>
            </tr>
        </table>
    </body>
</html>
